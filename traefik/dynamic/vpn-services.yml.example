# Traefik routing for media stack services
#
# REMOTE ACCESS (via Cloudflare Tunnel):
# - Jellyfin, Jellyseerr, WireGuard - user-facing services
#
# LOCAL-ONLY (access via NAS_IP:PORT or WireGuard VPN):
# - Sonarr, Radarr, Prowlarr, qBittorrent, Bazarr, Pi-hole
# - These have weak default auth ("Disabled for Local" / "Bypass localhost")
# - Use Jellyseerr for remote media requests instead

http:
  routers:
    jellyfin:
      rule: "Host(`jellyfin.yourdomain.com`)"
      entryPoints:
        - web
      service: jellyfin

    jellyseerr:
      rule: "Host(`jellyseerr.yourdomain.com`)"
      entryPoints:
        - web
      service: jellyseerr

    # Optional: Redirect common typo (jellyseer -> jellyseerr)
    jellyseer-typo:
      rule: "Host(`jellyseer.yourdomain.com`)"
      entryPoints:
        - web
      middlewares:
        - jellyseer-redirect
      service: jellyseerr

    wg:
      rule: "Host(`wg.yourdomain.com`)"
      entryPoints:
        - web
      service: wg

  middlewares:
    jellyseer-redirect:
      redirectRegex:
        regex: "^https?://jellyseer[.](.+)"
        replacement: "https://jellyseerr.${1}"
        permanent: true

  services:
    jellyfin:
      loadBalancer:
        servers:
          - url: "http://172.20.0.4:8096"

    jellyseerr:
      loadBalancer:
        servers:
          - url: "http://172.20.0.8:5055"

    wg:
      loadBalancer:
        servers:
          - url: "http://172.20.0.6:51821"
